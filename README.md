–ü–æ–Ω—è–ª üëç
–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π —Ü–µ–ª—å–Ω—ã–π Markdown-—Ñ–∞–π–ª –¥–ª—è —Ç–≤–æ–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Äî –º–æ–∂–µ—à—å –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ README.md:

# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ. –ß–∞—Å—Ç—å 2

---

## –ó–∞–¥–∞–Ω–∏–µ 1

**–£—Å–ª–æ–≤–∏–µ:**  
–û–ø–∏—à–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞–º–∏:

- –∞–∫—Ç–∏–≤–Ω—ã–π master-—Å–µ—Ä–≤–µ—Ä –∏ –ø–∞—Å—Å–∏–≤–Ω—ã–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π slave-—Å–µ—Ä–≤–µ—Ä;  
- master-—Å–µ—Ä–≤–µ—Ä –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ slave-—Å–µ—Ä–≤–µ—Ä–æ–≤.  

**–û—Ç–≤–µ—Ç:**

- **–ê–∫—Ç–∏–≤–Ω—ã–π master –∏ –ø–∞—Å—Å–∏–≤–Ω—ã–π slave**  
  - –ü–æ–≤—ã—à–∞–µ—Ç—Å—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –ø—Ä–∏ —Å–±–æ–µ master –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ slave.  
  - Slave –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–≥—Ä—É–∂–∞—Ç—å master.  
  - –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º —Å–æ —Å—Ä–µ–¥–Ω–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π.  

- **Master –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ slave-—Å–µ—Ä–≤–µ—Ä–æ–≤**  
  - –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø–æ —á—Ç–µ–Ω–∏—é: –∑–∞–ø—Ä–æ—Å—ã SELECT –º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ slave.  
  - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ master, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏.  
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–µ–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è slave –±–ª–∏–∂–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.  
  - –ì–∏–±–∫–æ—Å—Ç—å ‚Äî —Ä–∞–∑–Ω—ã–µ slave –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏.  

---

## –ó–∞–¥–∞–Ω–∏–µ 2

**–£—Å–ª–æ–≤–∏–µ:**  
–†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø–ª–∞–Ω –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —à–∞—Ä–¥–∏–Ω–≥–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.  
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö —Ç–∞–±–ª–∏—Ü:  
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏,  
- –∫–Ω–∏–≥–∏,  
- –º–∞–≥–∞–∑–∏–Ω—ã (—Å—Ç–æ–ª–±—Ü—ã –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ).  

–ù—É–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –∏—Ö —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.  
–ü—Ä–∏–ª–æ–∂–∏—Ç–µ –±–ª–æ–∫-—Å—Ö–µ–º—É –∏ —É–∫–∞–∂–∏—Ç–µ —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–æ–≤.

---

### 1) –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥ (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–æ–º–µ–Ω–∞–º)

- **Auth/User DB** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`users`, `user_profiles`, `auth_sessions`).  
- **Books DB** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∫–Ω–∏–≥–∏ (`books`, `authors`, `genres`, `book_inventory`).  
- **Stores DB** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –º–∞–≥–∞–∑–∏–Ω—ã (`stores`, `store_inventory`, `store_orders`).  

---

### 2) –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥ (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –¥–æ–º–µ–Ω–∞)

- **Users:** —à–∞—Ä–¥ –ø–æ `user_id % N`.  
- **Books:** —à–∞—Ä–¥ –ø–æ `book_id` –∏–ª–∏ `isbn_hash % N`.  
- **Stores:** —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —à–∞—Ä–¥ –ø–æ `region_code`.  

–ö–∞–∂–¥—ã–π —à–∞—Ä–¥: `Primary (RW) + Replica (RO)`.

---

### 3) –†–æ—É—Ç–∏–Ω–≥ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

- Routing: ProxySQL / MySQL Router.  
- –¢–∞–±–ª–∏—Ü–∞ `shard_map`: –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞—Ä—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è `–∫–ª—é—á ‚Üí —à–∞—Ä–¥`.

---

### 4) –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–æ–≤

- Primary ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å—å –∏ —á–∏—Ç–∞–µ—Ç.  
- Replica ‚Äî —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.  
- Failover ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ Replica –≤ Primary.  

---

### 5) –ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü

```sql
-- Users DB
CREATE TABLE users (
  user_id BIGINT PRIMARY KEY,
  email   VARCHAR(255) UNIQUE,
  name    VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Books DB
CREATE TABLE books (
  book_id   BIGINT PRIMARY KEY,
  isbn      VARCHAR(20) UNIQUE,
  title     VARCHAR(255),
  author_id BIGINT,
  published_at DATE
);

-- Stores DB
CREATE TABLE stores (
  store_id    BIGINT PRIMARY KEY,
  region_code VARCHAR(8),
  name        VARCHAR(255),
  address     VARCHAR(255)
);


‚∏ª

6) –ë–ª–æ–∫-—Å—Ö–µ–º–∞

flowchart LR
  subgraph Clients[–°–µ—Ä–≤–∏—Å—ã]
    A[Auth Service]
    B[Books Service]
    C[Stores Service]
  end

  R[Router/Proxy\n(RW->Primary, RO->Replica)]

  A --> R
  B --> R
  C --> R

  subgraph Users["Users DB"]
    U0P[(Shard U0 Primary)] --> U0R1[(Replica)]
    U1P[(Shard U1 Primary)] --> U1R1[(Replica)]
  end

  subgraph Books["Books DB"]
    B0P[(Shard B0 Primary)] --> B0R1[(Replica)]
    B1P[(Shard B1 Primary)] --> B1R1[(Replica)]
  end

  subgraph Stores["Stores DB"]
    S1[(Region R1 Primary)] --> S1R[(Replica)]
    S2[(Region R2 Primary)] --> S2R[(Replica)]
  end

  R --> U0P
  R --> U1P
  R --> B0P
  R --> B1P
  R --> S1
  R --> S2


‚∏ª

7) –ò—Ç–æ–≥
	‚Ä¢	–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–æ–º–µ–Ω–∞–º (Users/Books/Stores).
	‚Ä¢	–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞ –ø–æ –∫–ª—é—á—É.
	‚Ä¢	–ö–∞–∂–¥–æ–µ –∑–≤–µ–Ω–æ ‚Äî Primary + Replica, —á—Ç–µ–Ω–∏–µ —Å —Ä–µ–ø–ª–∏–∫, –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ Primary.
	‚Ä¢	–û–±–µ—Å–ø–µ—á–µ–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –≥–∏–±–∫–æ—Å—Ç—å —Ä–∞–∑–≤–∏—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã.

